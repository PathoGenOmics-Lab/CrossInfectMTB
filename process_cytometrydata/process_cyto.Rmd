---
title: "Cytometry Analysis"
author: "Paula Ruiz Rodriguez"
date: today
date-format: "DD/MM/YYYY"
format:
  html: 
    code-fold: true
    page-layout: article
    embed-resources: true
    smooth-scroll: true
    theme: minty
    toc: true
    toc-depth: 5
    toc-location: left
    toc-title: Summary
    number-sections: true
    grid:
      sidebar-width: 200px
      body-width: 1200px
      margin-width: 100px
      gutter-width: 1.5rem  
editor: visual
---
```{css zoom-lib-src, echo = FALSE}
script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"
```
```{js zoom-jquery, echo = FALSE}
 $(document).ready(function() {
    $('body').prepend('<div class=\"zoomDiv\"><img src=\"\" class=\"zoomImg\"></div>');
    // onClick function for all plots (img's)
    $('img:not(.zoomImg)').click(function() {
      $('.zoomImg').attr('src', $(this).attr('src')).css({width: '100%'});
      $('.zoomDiv').css({opacity: '1', width: 'auto', border: '1px solid white', borderRadius: '5px', position: 'fixed', top: '50%', left: '50%', marginRight: '-50%', transform: 'translate(-50%, -50%)', boxShadow: '0px 0px 50px #888888', zIndex: '50', overflow: 'auto', maxHeight: '100%'});
    });
    // onClick function for zoomImg
    $('img.zoomImg').click(function() {
      $('.zoomDiv').css({opacity: '0', width: '0%'}); 
    });
  });
```

```{r libraries, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(mycolorsTB)
library(tidyr)
library(plotly)
library(DT)
library(MASS)
library(ggfortify)
library("FactoMineR")
library("factoextra")
library(cluster)
library(corrplot)
library(ggpattern)
library(bbplot)
library(ggpubr)
library(plotly)
```

```{r load_data, message=FALSE, warning=FALSE, echo=FALSE}
raw_data <- read.table("raw3.txt", sep = "\t", dec = ",", header = TRUE)
```

# Controls
First, I analyze the controls for each experiment and cell type, summarizing their count (N), mean, median, maximum, minimum, and standard deviation.
```{r stats_table, message=FALSE, warning=FALSE}
control_cols <- grep("Control", names(raw_data), value = TRUE)
control_data <- raw_data[c("Experiment", "Strain", "Day", "Cell", "Cell_Type",
                           control_cols)]
control_data_unique <- unique(control_data)

control_data_long <- control_data_unique %>%
  pivot_longer(cols = c(ControlAN1, ControlAN2, ControlAN3, ControlAN4,
                        ControlAN5, ControlAN6, ControlAN7, ControlAN8),
               names_to = "Control",
               values_to = "Value") %>%
  pivot_longer(cols = c(ControlAN1_ID, ControlAN2_ID, ControlAN3_ID,
                        ControlAN4_ID, ControlAN5_ID, ControlAN6_ID,
                        ControlAN7_ID, ControlAN8_ID),
               names_to = "Control_ID",
               values_to = "ID") %>%
  filter(sub("ControlAN", "", Control) == sub("ControlAN", "",
                                              sub("_ID", "", Control_ID)))
control_data_long$Control_ID <- NULL
stats <- na.omit(control_data_long)
estadisticos <- stats %>%
  group_by(Experiment, Strain, Day, Cell, Cell_Type) %>%
  summarise(
    N = n(),
    mean = mean(Value, na.rm = TRUE),
    median = median(Value, na.rm = TRUE),
    min = min(Value, na.rm = TRUE),
    max = max(Value, na.rm = TRUE),
    sd = sd(Value, na.rm = TRUE)
  )
datatable(estadisticos)
```